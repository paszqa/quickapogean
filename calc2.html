<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Character Planner Skeleton</title>
    <style>
        @font-face {
            font-family: 'bedstead';
            src: url('bedstead-extracondensed.otf') format('truetype');
        }
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body, .stat-container, .stat-container > div, .levelnumber, .leveltitle {
            font-family: 'bedstead', Arial, sans-serif;
        }
        #planner-container {
            width: 100vw;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }
        .planner-upper {
            width: 100%;
            height: 55%;
            display: flex;
            flex-direction: row;
            border-bottom: 1px solid #000;
        }
        .planner-lower {
            width: 100%;
            height: 44%;
            border-top: 1px solid #000;
            display: flex;
            align-items: stretch;
            justify-content: stretch;
        }
        /* Upper columns */
        .upper-col1 {
            width: 12%;
            height: 100%;
            border-right: 1px solid #000;
            display: flex;
            flex-direction: column;
        }
        .upper-col1-segment {
            width: 100%;
            border-bottom: 1px solid #000;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1em;
        }
        .class-choice { height: 65%; }
        .level-choice { height: 12%; }
        .stat-counter { height: 10%; }
        .trait-counter { height: 13%; border-bottom: none; }
        .upper-dynamic-cell {
            width: 80%;
            height: 100%;
            border-left: 1px solid #000;
            display: flex;
        }
        .upper-col2 {
            width: 35%;
            height: 100%;
            display: flex;
            flex-direction: column;
            border-right: 1px solid #000;
        }
        .upper-col2-row1 {
            width: 100%;
            height: 69%;
            display: flex;
            border-bottom: 1px solid #000;
        }
        .upper-col2-row1-equip {
            width: 55%;
            height: 100%;
            border-right: 1px solid #000;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .upper-col2-row1-desc {
            width: 44%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .upper-col2-row2 {
            width: 100%;
            height: 29%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .upper-col3 {
            width: 35%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            border-left: 1px solid #000;
        }
        /* Lower segment */
        .stats-table-container {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px solid #000;
        }
        .class-choice-row {
            display: flex;
            align-items: center;
            border: 1px solid #aaa;
            margin: 2px 0;
            padding: 4px;
            cursor: pointer;
            background: #222;
            color: #fff;
            transition: background 0.2s;
        }
        .class-choice-row.selected {
            background: #eaff8c;
            color: #222;
            border: 2px solid #eaff8c;
        }
        .class-choice-row img {
            width: 32px;
            height: 32px;
            margin-right: 10px;
        }
        .level-choice-inner {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        .leveltitle {
            margin-bottom: 5px;
            color: #fff;
        }
        .levelnumber {
            width: 80px;
            height: 40px;
            font-size: 1.2em;
            font-weight: bold;
            text-align: center;
            border: 1px solid #aaa;
            border-radius: 8px;
            background-color: #222;
            color: #eaff8c;
        }
        .stat-table-outer {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }
        .stat-container {
            display: grid;
            grid-template-columns: 120px 100px 50px 40px 40px 40px 140px 100px 140px 100px 140px 100px ;
            gap: 0px;
            width: 1140px;
            margin-bottom: 0px;
            border-bottom: 1px solid #333;
            margin-top: 2px;
        }
        .stat-container > div {
            padding: 1px;
            border: 0px solid black;
            text-align: center;
        }
        .item-grid {
            display: grid;
            grid-template-columns: repeat(3, 48px);
            grid-template-rows: repeat(4, 48px);
            gap: 5px;
            margin-left: 20px;
        }
        .item-slot {
            width: 48px;
            height: 48px;
            border: 2px solid rgb(54, 54, 54);
            border-radius: 4px;
            background-color: rgb(36, 0, 0);
            cursor: pointer;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .selected-equip-slot {
            outline: 2px solid #eaff8c;
        }
        .selection-grid {
            display: grid;
            grid-template-columns: repeat(4, 48px);
            gap: 6px;
            margin: 10px;
        }
        .selection-item {
            width: 48px;
            height: 48px;
            border: 1px solid #aaa;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #222;
            cursor: pointer;
        }
        .selection-item img {
            width: 40px;
            height: 40px;
        }
        .class-choice-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            width: 100%;
            height: 100%;
            align-items: center;
            justify-items: center;
        }
        .class-choice-cell {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: transform 0.2s;
        }
        .class-choice-cell:hover {
            transform: scale(1.1);
        }
        .class-choice-cell img {
            width: 64px;
            height: 64px;
            margin-bottom: 5px;
        }
        /* --- TRAIT TREE STYLES (ported from calc.html) --- */
        .traits-panel {
            position: relative;
            width: 100%;
            height: 100%;
            margin-left: 0;
            background-color: rgba(36, 0, 0, 0);
            padding: 0px;
            border: 0px solid rgb(54, 54, 54);
            border-radius: 4px;
            color: rgb(239, 255, 148);
            display: flex;
            flex-wrap: wrap;
            overflow: auto;
        }
        .connector {
            position: absolute;
            z-index: 0;
            pointer-events: none;
            stroke: black;
            stroke-width: 2;
        }
        .trait {
            z-index: 1;
            position: absolute;
            margin: 2px;
            border: 2px solid #000000;
            background: #3d3d3d;
            display: flex;
            flex-direction: column;
            width: 100px;
            height: fit-content;
            border-radius: 5px;
            user-select: none;
            -webkit-user-select: none;
            -moz-user-select: none;
        }
        div.trait.active {
            background-color: rgb(57, 117, 0);
            transition: 0.5s;
        }
        .trait-title {
            font-weight: normal;
            margin-bottom: 0px;
            font-size: 0.5em;
            line-height: 1em;
            text-align: center;
            padding-right: 8px;
            padding-left: 8px;
            color: #d4b503;
        }
        .trait-description {
            margin-bottom: 2px;
            font-size: 0.4em;
            text-align: center;
            line-height: 0.8em;
            display: flex;
            justify-content: center;
            align-items: top;
            padding: 0;
            padding-top: 5px;
            opacity: 0.9;
            color: #dace8d;
        }
        .trait-stages {
            display: flex;
            justify-content: center;
            align-items: center;
            vertical-align: bottom;
            padding-top: 3px;
            font-size: 0.5em;
        }
        .trait-stages button {
            margin-right: 2px;
            margin-left: 2px;
            border-radius: 0;
            width: 65px;
            height: 15px;
            background-color: transparent;
            border: 0px solid transparent;
            font-family: 'bedstead', Arial, sans-serif;
            font-size: 0.9em;
            margin-bottom: 5px;
            line-height: 0.55em;
            color:rgb(0, 0, 0);
            font-weight: 50;
            text-shadow: 2px 2px 2px #0000008f;
        }
        .trait-stages button.active {
            color: rgb(234, 255, 47);
        }
        .trait-stages button.active.first-stage {
            color: rgb(90, 92, 67);
            display: none;
        }
        .trait-stages button.first-stage{
            display: none;
        }
        .trait.requirement-error {
            border: 2px solid #ff3333 !important;
            box-shadow: 0 0 8px 2px #ff3333;
            transition: border 0.2s, box-shadow 0.2s;
        }
    </style>
</head>
<body>
<div id="planner-container">
    <div class="planner-upper">
        <div class="upper-col1">
            <div class="upper-col1-segment class-choice">
                <div class="class-choice-grid">
                    <div class="class-choice-cell" data-class="Squire">
                        <img src="squire.png" alt="Squire">
                        <span>Squire</span>
                    </div>
                    <div class="class-choice-cell" data-class="Knight">
                        <img src="knight.png" alt="Knight">
                        <span>Knight</span>
                    </div>
                    <div class="class-choice-cell" data-class="Rogue">
                        <img src="rogue.png" alt="Rogue">
                        <span>Rogue</span>
                    </div>
                    <div class="class-choice-cell" data-class="Mage">
                        <img src="mage.png" alt="Mage">
                        <span>Mage</span>
                    </div>
                </div>
            </div>
            <div class="upper-col1-segment level-choice">
                <div class="level-choice-inner">
                    <label class="leveltitle" for="level-input">Character Level:</label>
                    <input class="levelnumber" type="number" id="level-input" min="1" max="100" value="1">
                </div>
            </div>
            <div class="upper-col1-segment stat-counter">Stat Counter</div>
            <div class="upper-col1-segment trait-counter">Trait Counter</div>
        </div>
        <div class="upper-dynamic-cell">
            <div id="planner-ui" style="width: 100%; height: 100%; display: flex; flex-direction: row;">
                <div class="upper-col2">
                    <div class="upper-col2-row1">
                        <div class="upper-col2-row1-equip">
                            <div class="item-grid">
                                <div class="item-slot" data-slot="neck"></div>
                                <div class="item-slot" data-slot="head"></div>
                                <div class="item-slot" data-slot="bagslot"></div>
                                <div class="item-slot" data-slot="hand"></div>
                                <div class="item-slot" data-slot="chest"></div>
                                <div class="item-slot" data-slot="hand"></div>
                                <div class="item-slot" data-slot="ring"></div>
                                <div class="item-slot" data-slot="legs"></div>
                                <div class="item-slot" data-slot="bagslot"></div>
                                <div class="item-slot-x" data-slot="NONE"></div>
                                <div class="item-slot" data-slot="boots"></div>
                            </div>
                        </div>
                        <div class="upper-col2-row1-desc">Description</div>
                    </div>
                    <div class="upper-col2-row2">Big Cell</div>
                </div>
                <div class="upper-col3">Item Picker</div>
            </div>
            <div id="trait-tree-ui" style="width: 100%; height: 100%; display: none; align-items: center; justify-content: center; font-size: 2em;">
                Trait tree
            </div>
        </div>
    </div>
    <div class="planner-lower">
        <div class="stats-table-container" id="stats-table-container">
            <!-- Stats table will be generated here by JS -->asdasd
        </div>
    </div>
</div>
<script>
        // --- Class selection logic ---
        const classRows = [
            { name: "Squire", icon: "squire.png" },
            { name: "Knight", icon: "knight.png" },
            { name: "Rogue", icon: "rogue.png" },
            { name: "Mage", icon: "mage.png" }
        ];
        let selectedClass = null;
        let selectedLevel = 1;
        window.addEventListener('DOMContentLoaded', function() {
            // Make class rows selectable
            document.querySelectorAll('.class-choice-cell').forEach(row => {
                row.addEventListener('click', function() {
                    document.querySelectorAll('.class-choice-cell').forEach(r => r.classList.remove('selected'));
                    this.classList.add('selected');
                    selectedClass = this.getAttribute('data-class');
                    updateDebug();
                });
            });
            // Level input
            const levelInput = document.getElementById('level-input');
            levelInput.addEventListener('input', function() {
                let val = parseInt(this.value) || 1;
                if(val < 1) val = 1;
                if(val > 100) val = 100;
                this.value = val;
                selectedLevel = val;
                updateDebug();
            });
            // Set default selection
            document.querySelector('.class-choice-cell[data-class="Squire"]').click();
        });
        function updateDebug() {
            document.getElementById('stats-table-container').innerText =
                `Selected class: ${selectedClass || ''}\nLevel: ${selectedLevel}`;
        }
    </script>
<script>
// --- Item Database ---

        const items = [
            //comment the variable names
            //name, slot, type, weight, range, damage, HP, Mp, skill, magic, armor, defense, moveSpeed, attackSpeed, emptyholder, equipSize, description, image
            ["Black Bag","bagslot","container",80,,,,,,,,,,,,,,,"","BlackBag.png",""],
["Black Bag","bagslot","container",64,,,,,,,,,,,,,,,"","BlackBag.png","uncommon"],
["Blue Backpack","bagslot","container",160,,,,,,,,,,,,,,,"<empty>","BlueBackpack.png",""],
["Bone Bow","hand","bow",200,37,10,,,,,,,,4,,8,,,"A magic bow.","BoneBow.png",""],
["Bone Knife","hand","dagger",160,,9,,,,,,,,1,,3,,,"","BoneKnife.png",""],
["Bone Knife","hand","dagger",96,,11,,,,,,,,3,,3,,,"","BoneKnife.png","epic"],
["Bone Knife","hand","dagger",80,1,12,,,,,,,,4,,3,,,"","BoneKnife.png","legendary"],
["Brass Legs","legs","heavylegs",470,,,,,,,5,,,,,,,,"","BrassLegs.png",""],
["Brass Legs","legs","heavylegs",376,,,,,,,5,,,,,,,,"","BrassLegs.png","uncommon"],
["Brass Plate","chest","heavychest",790,,,,,,,10,,,,,,,,"","BrassPlate.png",""],
["Brass Shield","hand","lightshield",200,,,,,,,,15,,,,3,,,"Surprisingly light.","BrassShield.png",""],
["Brass Shield","hand","lightshield",140,,,,,,,,19,,,,3,,,"Surprisingly light.","BrassShield.png","rare"],
["Brass Shield","hand","lightshield",120,,,,,,,,21,,,,3,,,"Surprisingly light.","BrassShield.png","epic"],
["Brass Shield","hand","lightshield",120,,,,,,,,21,,,,3,,,"Surprisingly light.","BrassShield.png","legendary"],
["Brigandine Legs","legs","lightlegs",304,,,18,,1,,6,,,,,,,,"","BrigandineLegs.png","uncommon"],
["Brigandine Legs","legs","lightlegs",228,,,21,,3,,8,,,,,,,,"","BrigandineLegs.png","epic"],
["Brigandine Vest","chest","lightchest",580,,,20,,2,,8,,,,,,,,"","BrigandineVest.png",""],
["Broadsword","hand","sword",750,2,28,,,,,,7,,-2,,8,,,"","Broadsword.png",""],
["Broadsword","hand","sword",750,2,33,,,,,,7,,-2,,8,,,"","Broadsword.png","uncommon"],
["Broadsword","hand","sword",750,2,36,,,,,,8,,-1,,8,,,"","Broadsword.png","rare"],
["Broadsword","hand","sword",750,2,39,,,,,,9,,,,8,,,"","Broadsword.png","epic"],
["Brown Backpack","bagslot","container",160,,,,,,,,,,,,,,,"","BrownBackpack.png",""],
["Buckler","hand","lightshield",160,,,,,,,,10,,,,3,,,"","Buckler.png",""],
["Buckler","hand","lightshield",128,,,,,,,,12,,,,3,,,"","Buckler.png","uncommon"],
["Buckler","hand","lightshield",96,,,,,,,,16,,,,3,,,"","Buckler.png","epic"],
["Burlap Hat","head","lighthelmet",100,,,,50,-2,-2,1,,,,,,,,"","BurlapHat.png",""],
["Burlap Skirt","legs","lightlegs",200,,,,100,-5,-5,3,,,,,,,,"","BurlapSkirt.png",""],
["Chain Mail","chest","heavychest",810,,,,,,,8,,,,,,,,"","ChainMail.png",""],
["Chain Mail","chest","heavychest",648,,,,,,,8,,,,,,,,"","ChainMail.png","uncommon"],
["Chain Mail","chest","heavychest",567,,,,,,,9,,,,,,,,"","ChainMail.png","rare"],
["Chain Mail","chest","heavychest",405,,,,,,,11,,,,,,,,"","ChainMail.png","legendary"],
["Cloth Pants","legs","lightlegs",80,,,,,,,1,,,,,,,,"","ClothPants.png",""],
["Cloth Pants","legs","lightlegs",64,,,,,,,1,,,,,,,,"","ClothPants.png","uncommon"],
["Cloth Pants","legs","lightlegs",56,,,,,,,1,,,,,,,,"","ClothPants.png","rare"],
["Cloth Pants","legs","lightlegs",48,,,,,,,1,,,,,,,,"","ClothPants.png","epic"],
["Cloth Vest","chest","lightchest",200,,,,,,,2,,,,,,,,"","ClothVest.png",""],
["Cloth Vest","chest","lightchest",160,,,,,,,2,,,,,,,,"","ClothVest.png","uncommon"],
["Cloth Vest","chest","lightchest",140,,,,,,,3,,,,,,,,"","ClothVest.png","rare"],
["Cloth Vest","chest","lightchest",120,,,,,,,3,,,,,,,,"","ClothVest.png","epic"],
["Cloth Vest","chest","lightchest",100,,,,,,,3,,,,,,,,"","ClothVest.png","legendary"],
["Crowbar","hand","tools",130,,3,,,,,,,,,,4,,,"","Crowbar.png",""],
["Crowbar","hand","tools",104,,3,,,,,,,,,,4,,,"","Crowbar.png","uncommon"],
["Crowbar","hand","tools",91,,4,,,,,,,,,,4,,,"","Crowbar.png","rare"],
["Crystal Ring","ring","ring",8,,,,,,2,,,,,,,,,"","CrystalRing.png",""],
["Crystal Ring","ring","ring",6,,,,,,3,,,,,,,,,"","CrystalRing.png","rare"],
["Crystal Ring","ring","ring",5,,,,,,4,,,,,,,,,"","CrystalRing.png","epic"],
["Crystal Staff","hand","staff",200,37,10,,,,,,,,1,,8,,,"A light staff.","CrystalStaff.png",""],
["Crystal Staff","hand","staff",160,42,12,,,,,,,,1,,8,,,"A light staff.","CrystalStaff.png","uncommon"],
["Crystal Staff","hand","staff",140,44,13,,,,,,,,2,,8,,,"A light staff.","CrystalStaff.png","rare"],
["Crystal Staff","hand","staff",120,47,14,,,,,,,,3,,8,,,"A light staff.","CrystalStaff.png","epic"],
["Cutlass","hand","sword",450,2,25,,,,,,3,,3,,6,,,"A sailor’s sword.","Cutlass.png",""],
["Dark Hood","head","lighthelmet",60,,,-10,,3,,2,,,,,,,,"A hood longs for life.","DarkHood.png",""],
["Dark Hood","head","lighthelmet",42,,,-7,,4,,2,,,,,,,,"A hood longs for life.","DarkHood.png","rare"],
["Dark Hood","head","lighthelmet",36,,,-7,,5,,2,,,,,,,,"A hood longs for life.","DarkHood.png","epic"],
["Dark Robe","chest","lightchest",160,,,-35,,,4,4,,,,,,,,"The robe longs for life.","DarkRobe.png",""],
["Dark Robe","chest","lightchest",128,,,-28,,,4,4,,,,,,,,"The robe longs for life.","DarkRobe.png","uncommon"],
["Druid Hat","head","lighthelmet",95,,,40,,,1,3,,,,,,,,"","DruidHat.png",""],
["Epee","hand","sword",180,2,19,,,,,,2,,3,,6,,,"A fencing sword.","Epee.png",""],
["Epee","hand","sword",144,2,23,,,,,,2,,3,,6,,,"A fencing sword.","Epee.png","uncommon"],
["Euler Pants","legs","lightlegs",100,,,,,,2,4,,,,,,,,"","EulerPants.png",""],
["Gambeson","chest","lightchest",300,,,10,,,,5,,,,,,,,"","Gambeson.png",""],
["Gambeson","chest","lightchest",180,,,14,,,,7,,,,,,,,"","Gambeson.png","epic"],
["Garnet Ring","ring","ring",120,,,,,,,,,1,,,,,,"","GarnetRing.png",""],
["Golden Ring","ring","ring",7,,,35,,,,,,,,,,,,"","GoldenRing.png",""],
["Golden Ring","ring","ring",6,,,42,,,,,,,,,,,,"","GoldenRing.png","uncommon"],
["Golden Ring","ring","ring",5,,,45,,,,,,,,,,,,"","GoldenRing.png","rare"],
["Gray Backpack","bagslot","container",190,,,,,,,,,,,,,,,"Crafted from rough linen.","GrayBackpack.png",""],
["Green Bag","bagslot","container",80,,,,,1,,,,,,,,,,"It has a blue gem in it.","GreenBag.png",""],
["Green Bag","bagslot","container",40,,,,,4,,,,,,,,,,"It has a blue gem in it.","GreenBag.png","legendary"],
["Green Orb","hand","orb",275,,3,25,25,,3,,3,,,,2,,,"A mirror to another dimension.","GreenOrb.png",""],
["Ironsword","hand","sword",360,2,14,,,,,,2,,2,,6,,,"","Ironsword.png",""],
["Ironsword","hand","sword",288,2,16,,,,,,2,,2,,6,,,"","Ironsword.png","uncommon"],
["Ironsword","hand","sword",252,2,18,,,,,,3,,3,,6,,,"","Ironsword.png","rare"],
["Ironsword","hand","sword",216,2,19,,,,,,4,,4,,6,,,"","Ironsword.png","epic"],
["Kettle Helmet","head","heavyhelmet",350,,,,,,,3,,,,,,,,"","KettleHelmet.png",""],
["Knife","hand","dagger",80,,3,,,,,,,,3,,2,,,"","Knife.png",""],
["Knife","hand","dagger",64,,3,,,,,,,,3,,2,,,"","Knife.png","uncommon"],
["Knife","hand","dagger",56,,4,,,,,,,,4,,2,,,"","Knife.png","rare"],
["Knife","hand","dagger",48,,5,,,,,,,,5,,2,,,"","Knife.png","epic"],
["Knife","hand","dagger",40,1,6,,,,,,,,6,,2,,,"","Knife.png","legendary"],
["Leather Bascinet","head","lighthead",100,,,,,,,1,,,,,,,,"","LeatherBascinet.png",""],
["Leather Bascinet","head","lighthead",80,,,,,,,1,,,,,,,,"","LeatherBascinet.png","uncommon"],
["Leather Bascinet","head","lighthead",70,,,,,,,1,,,,,,,,"","LeatherBascinet.png","rare"],
["Leather Bascinet","head","lighthead",50,,,,,,,1,,,,,,,,"","LeatherBascinet.png","legendary"],
["Leather Boots","boots","lightboots",100,,,,,,,1,,,,,,,,"","LeatherBoots.png",""],
["Leather Boots","boots","lightboots",80,,,,,,,1,,,,,,,,"","LeatherBoots.png","uncommon"],
["Leather Boots","boots","lightboots",60,,,,,,,1,,,,,,,,"","LeatherBoots.png","epic"],
["Leather Boots","boots","lightboots",50,,,,,,,1,,,,,,,,"","LeatherBoots.png","legendary"],
["Leather Cloak","chest","lightchest",100,,,,,,,3,,,,,,,,"","LeatherCloak.png",""],
["Leather Coif","head","lighthead",140,,3,,,,,4,,,,,,,,"","LeatherCoif.png",""],
["Leather Collar","neck","lightneck",200,,,,,,,2,,,,,,,,"","LeatherCollar.png",""],
["Leather Collar","neck","lightneck",140,,,,,,,3,,,,,,,,"","LeatherCollar.png","rare"],
["Leather Collar","neck","lightneck",120,,,,,,,3,,,,,,,,"","LeatherCollar.png","epic"],
["Leather Cuisse","legs","lightlegs",290,,,,,,,2,,,,,,,,"","LeatherCuisse.png",""],
["Leather Cuisse","legs","lightlegs",322,,,,,,,2,,,,,,,,"","LeatherCuisse.png","uncommon"],
["Leather Cuisse","legs","lightlegs",203,,,,,,,3,,,,,,,,"","LeatherCuisse.png","rare"],
["Leather Cuisse","legs","lightlegs",174,,,,,,,3,,,,,,,,"","LeatherCuisse.png","epic"],
["Leather Gloves","hand","gloves",150,,3,,,4,,1,,,,,1,,,"","LeatherGloves.png",""],
["Leather Gloves","hand","gloves",105,,4,,,5,,1,,,,,1,,,"","LeatherGloves.png","rare"],
["Longbow","hand","bow",370,57,20,,,,,,,,-1,,9,,,"","Longbow.png",""],
["Longbow","hand","bow",296,64,24,,,,,,,,-1,,9,,,"","Longbow.png","uncommon"],
["Longsword","hand","sword",980,7,38,,,,,,10,,-2,,8,,,"","Longsword.png",""],
["Magician Hat","head","lighthelmet",100,,,,,,3,2,,,,,,,,"","MagicianHat.png",""],
["Merchant’s Bag","bagslot","container",550,,,10,,,,,,,,,,,,"A bag for trading.","MerchantsBag.png",""],
["Merchant’s Bag","bagslot","container",460,,,12,,,,,,,,,,,,"A bag for trading.","MerchantsBag.png","uncommon"],
["Merchant’s Bag","bagslot","container",330,,,14,,,,,,,,,,,,"A bag for trading.","MerchantsBag.png","epic"],
["Nightshade Robe","chest","lightchest",175,,,,,-5,1,7,,,,,,,,"The robe makes you feel lighter.","NightshadeRobe.png",""],
["Old Gloves","hand","gloves",100,,2,,,2,,,,,,,1,,,"","OldGloves.png",""],
["Old Gloves","hand","gloves",70,,3,,,3,,,,,,,1,,,"","OldGloves.png","rare"],
["Old Gloves","hand","gloves",60,,4,,,4,,,,,,,1,,,"","OldGloves.png","epic"],
["Orb","hand","orb",190,,,,,,2,,2,,,,2,,,"A magical orb.","Orb.png",""],
["Orb","hand","orb",152,,,,,,2,,2,,,,2,,,"A magical orb.","Orb.png",""],
["Pestilence Sword","hand","sword",850,6,50,,50,-6,4,,7,,-1,,8,,,"A magic sword.","PestilenceSword.png",""],
["Plated Cuirass","chest","heavychest",1050,,,,,,,12,,,,,,,,"","PlatedCuirass.png",""],
["Plated Helmet","head","heavyhelmet",350,,,,,,,6,,,,,,,,"","PlatedHelmet.png",""],
["Plated Helmet","head","heavyhelmet",280,,,,,,,6,,,,,,,,"","PlatedHelmet.png","uncommon"],
["Plated Legs","legs","heavylegs",700,,,,,,,7,,,,,,,,"","PlatedLegs.png",""],
["Plated Shield","hand","heavyshield",800,,,,,,,,20,,,,4,,,"","PlatedShield.png",""],
["Quoki Headgear","head","lightmask",45,,,-22,,,,,,,1,,,,,"Customary headpiece.","QuokiHeadgear.png",""],
["Quoki Headgear","head","lightmask",40,,,-20,,,,,,,1,,,,,"Customary headpiece.","QuokiHeadgear.png","uncommon"],
["Quoki Headgear","head","lightmask",35,,,-18,,,,,,,2,,,,,"Customary headpiece.","QuokiHeadgear.png","rare"],
["Quoki Headgear","head","lightmask",30,,,-16,,,,,,,3,,,,,"Customary headpiece.","QuokiHeadgear.png","epic"],
["Quoki Shoes","boots","lightboots",50,,,-25,,,,,,1,,,,,,"Customary footwear.","QuokiShoes.png",""],
["Quoki Shoes","boots","lightboots",30,,,-16,,,,1,,3,,,,,,"Customary footwear.","QuokiShoes.png","epic"],
["Red Orb","hand","orb",210,,10,-75,,5,,,3,,,,2,,,"Evil looks through it.","RedOrb.png",""],
["Red Orb","hand","orb",168,,12,-60,,5,,,3,,,,2,,,"Evil looks through it.","RedOrb.png","uncommon"],
["Red Orb","hand","orb",147,,13,-53,,6,,,4,,,,2,,,"Evil looks through it.","RedOrb.png","rare"],
["Regeneration Ring","ring","ring",10,,,,,,,,,,,,,,,"The ring feels temporary.","RegenerationRing.png",""],
["Royal Armor","chest","heavychest",920,,,,,,,14,,,,,,,,"The royal cross is carved in its chest.","RoyalArmor.png",""],
["Royal Dagger","hand","dagger",150,1,7,,,,2,,,,4,,2,,,"A bright gem shines in its hilt.","RoyalDagger.png",""],
["Ruby Amulet","neck","necklace",15,,2,,,2,,,,,,,,,,"","RubyAmulet.png",""],
["Ruby Amulet","neck","necklace",12,,2,,,2,,,,,,,,,,"","RubyAmulet.png","uncommon"],
["Ruby Amulet","neck","necklace",11,,3,,,3,,,,,,,,,,"","RubyAmulet.png","rare"],
["Rusty Sword","hand","sword",300,2,9,,,,,,2,,2,,6,,,"","RustySword.png",""],
["Scarf","neck","lightneck",75,,,,,,,1,,,,,,,,"A very thick scarf.","Scarf.png",""],
["Scarf","neck","lightneck",53,,,,,,,1,,,,,,,,"A very thick scarf.","Scarf.png",""],
["Shovel","hand","sword?",260,,8,,,,,,2,,,,6,,,"Used to open holes.","Shovel.png",""],
["Silver Amulet","neck","necklace",20,,,,35,,,,,,,,,,,"","SilverAmulet.png",""],
["Silver Amulet","neck","necklace",16,,,,42,,,,,,,,,,,"","SilverAmulet.png","uncommon"],
["Silver Dagger","hand","dagger",70,,4,,,,,,,,4,,2,,,"For rituals.","SilverDagger.png",""],
["Silver Dagger","hand","dagger",56,,4,,,,,,,,4,,2,,,"For rituals.","SilverDagger.png","uncommon"],
["Silver Dagger","hand","dagger",49,,5,,,,,,,,5,,2,,,"For rituals.","SilverDagger.png","rare"],
["Silver Dagger","hand","dagger",42,,6,,,,,,,,6,,2,,,"For rituals.","SilverDagger.png","epic"],
["Silver Dagger","hand","dagger",35,1,7,,,,,,,,7,,2,,,"For rituals.","SilverDagger.png","legendary"],
["Silver Mask","head","lightmask",90,,,-5,10,,,1,,,,,,,,"","SilverMask.png",""],
["Silver Mask","head","lightmask",72,,,-5,12,,,1,,,,,,,,"","SilverMask.png","uncommon"],
["Silver Ring","ring","ring",10,,,,15,,,,,,,,,,,"","SilverRing.png",""],
["Silver Ring","ring","ring",8,,,,18,,,,,,,,,,,"","SilverRing.png","uncommon"],
["Simple Bag","bagslot","container",80,,,,,,,,,,,,,,,"","SimpleBag.png",""],
["Simple Bag","bagslot","container",64,,,,,,,,,,,,,,,"","SimpleBag.png","uncommon"],
["Simple Bag","bagslot","container",48,,,,,,,,,,,,,,,"","SimpleBag.png","epic"],
["Spangenhelm","head","heavyhelmet",400,,,,,,,5,,,,,,,,"","Spangenhelm.png",""],
["Spangenhelm","head","heavyhelmet",320,,,,,,,5,,,,,,,,"","Spangenhelm.png","uncommon"],
["Spangenhelm","head","heavyhelmet",280,,,,,,,6,,,,,,,,"","Spangenhelm.png","rare"],
["Square Bag","bagslot","container",100,,,,,,1,,,,,,,,,"","SquareBag.png",""],
["Square Bag","bagslot","container",96,,,,,,1,,,,,,,,,"","SquareBag.png","uncommon"],
["Steelsword","hand","sword",45,3,18,,,,,,4,,3,,6,,,"","Steelsword.png",""],
["Stone Shortbow","hand","bow",330,37,25,,,,,,,,,,8,,,"A sturdy small bow.","StoneShortbow.png",""],
["Stone Wand","hand","staff",900,37,13,,,,,,,,2,,8,,,"Tight on grip.","StoneWand.png",""],
["Studded Shield","hand","heavyshield",420,,,,,,,,15,,,,4,,,"","StuddedShield.png",""],
["Studded Shield","hand","heavyshield",294,,,,,,,,19,,,,4,,,"","StuddedShield.png","rare"],
["Studded Shield","hand","heavyshield",252,,,,,,,,21,,,,4,,,"","StuddedShield.png","epic"],
["Torch","hand","sword?",50,,2,,,,,,,,,,,,,"","Torch.png",""],
["Torch","hand","sword?",40,,2,,,,,,,,,,,,,"","Torch.png","uncommon"],
["Torch","hand","sword?",35,,3,,,,,,,,,,,,,"","Torch.png","rare"],
["Torch","hand","sword?",30,,4,,,,,,,,,,,,,"","Torch.png","epic"],
["Torch","hand","sword?",25,,5,,,,,,,,,,,,,"","Torch.png","legendary"],
["Tower Shield","hand","heavyshield",690,,,,,,,,25,,,,4,,,"A royal shield.","TowerShield.png",""],
["Winged Boots","boots","lightboots",100,,,,,,,,-10,5,,,,,,"These loose boots seem to make you lighter.","WingedBoots.png",""],
["Wizard Hat","head","lighthelmet",60,,,,75,,1,1,,,,,,,,"A pointy hat.","WizardHat.png",""],
["Wooden Bow","hand","bow",290,47,15,,,,,,,,,,8,,,"","WoodenBow.png",""],
["Wooden Bow","hand","bow",232,53,18,,,,,,,,,,8,,,"","WoodenBow.png","uncommon"],
["Wooden Bow","hand","bow",203,56,19,,,,,,,,,,8,,,"","WoodenBow.png","rare"],
["Wooden Bow","hand","bow",174,59,21,,,,,,,,,,8,,,"","WoodenBow.png","epic"],
["Wooden Shield","hand","heavyshield",250,,,,,,,,5,,,,4,,,"","WoodenShield.png",""],
["Wooden Staff","hand","staff",300,32,5,,,,,,,,2,,8,,,"A simple piece of wood, however, curled weirdly.","WoodenStaff.png",""],
["Wooden Staff","hand","staff",240,36,5,,,,,,,,2,,8,,,"A simple piece of wood, however, curled weirdly.","WoodenStaff.png","uncommon"],
["Wooden Staff","hand","staff",180,41,7,,,,,,,,4,,8,,,"A simple piece of wood, however, curled weirdly.","WoodenStaff.png","epic"],
["Zircon Ring","ring","ring",12,,,,,,,,,,1,,,,,"","ZirconRing.png",""],

];

// --- Traits database ---
const traits = [
        [0,0,"start","starts",[0],0,0,0,0,0,0],
[1,0,"Staff Mastery","Staves have a X% chance of shooting without cost",[0,15,25,40,60,90],0,0,0,0,-100,50],
[2,1,"Charge the Staff","Casting an Elemental spell using a staff will make your next attack deal extra (Magic Level / X) damage",["Off",5,4,2],0,0,0,0,-200,100],
[3,2,"Gallop’s Fall","Reduces the cooldown of Water spells by X%",[0,10,20,35],0,0,0,0,-300,200],
[4,3,"Sacred Stick","While holding a staff, gain 1 extra Area of Effect for Holy spells and 25% cooldown reduction for Holy spells",["Off", "active"],3,3,1,5,-400,200],
[5,2,"Franctic Conjury","Casting a Fire spell has a X% chance your next attack will cast Conjure Fire at target's location",[0, 15,20,30],0,0,0,0,-300,100],
[6,5,"Conflagrated Mind","While holding a staff gain 1 extra Area of Effect and 25% cooldown reudction for Fire spells",["Off","active"],5,3,1,5,-400,100],
[7,6,"Warlock","Gain 1 Area of Effect and doubles the cooldown of all spells",["Off","active"],0,0,0,0,-500,100],
[8,0,"Pondering It","Orbs give +X% Spellvamp",[0,1,3,6,10,15],0,0,0,0,-100,-20],
[9,8,"Electric Nature","Reduces the cooldown of spells by X%",[0,7,10,15],0,0,0,0,-200,-20],
[10,9,"Diamond Skin","Hitting and enemy with an Energy or Arrow spell gives you X magic shield, capping at 100",[0,20,30,50],0,0,0,0,-300,-20],
[11,10,"Unstable Aegis","Taking Magic Shield damage has a 50% chance of casting Unstable Berserk around yourself",["Off","active"],10,3,8,5,-400,-20],
[12,9,"Magic Touch","Heal spells are X% stronger",[0,10,15,25],0,0,0,0,-300,-100],
[13,12,"Apogea’s Ardor","While holding an Orb, Heal spells cost 50% less mana",["Off","active"],12,3,8,5,-400,-100],
[14,13,"Child’s channel","Healing others also heals you, reduces the cooldown of all spells by 50% and spells deal 75% less dammage",["Off","active"],0,0,0,0,-500,-100],
[15,0,"Blade training","Regular swords have X% extra damage",[0,1,4,8,13,20],0,0,0,0,-100,-100],
[16,15,"Hand Finesse","Gain 1 Attackspeed for each X Ability you have capping at 5",[0,15,13,10],0,0,0,0,-200,-150],
[17,16,"Fencing Classes","Blade spells are X% stronger",[0,5,9,15],0,0,0,0,-300,-200],
[18,17,"Blade Prowess","While holding one sword of size 6 and no shield, reduces the cooldown of Blade spells by 50%",["Off","active"],17,3,15,5,-400,-250],
[19,18,"Highlander","Blade spells cost 50% less mana, lose the ability to auto-attack. Additionally, converts every 2 Attackspeed into 1 Damage",["Off","active"],0,0,0,0,-500,-200],
[20,16,"Dual-wielding","Size 6 swords have an equipsize of 5, but deal X% less damage",[0,40,36,30],0,0,0,0,-200,-250],
[21,20,"To be Ninja","Attacking has a 25% chance of boosting your Movespeed by 10 for 4 seconds",["Off","active"],16,3,15,5,-350,-350],
[22,0,"Glove Passion","While wearing gloves, gain X Mana or Health Regen depending on the item you're holding",[0,1,2,3,6,10],0,0,0,0,0,-100],
[23,22,"True Grip","While wearing gloves, attacking regenerates X mana",[0,1,2,4],0,0,0,0,0,-200],
[24,23,"Unnatural Flow","Your attacks deal X extra True Damage",[0,4,7,12],0,0,0,0,-50,-300],
[25,24,"Battle Mage","Converts 50 Max Mana into 1 extra True Damage",["Off","active"],24,3,22,5,-50,-400],
[26,25,"One with Apogea","Mana damage is reduced in half. Mana damage is reduced in half, all spells cost 5 times more.",["Off","active"],0,0,0,0,-150,-400],
[27,23,"Elvish Practice","Spells cost X% less mana",[0,7,10,15],0,0,0,0,50,-300],
[28,27,"Arcane Trickster","While using Gloves, casting a Time or Mystic spell has a 50% chance of blocking all physical damage for 4 seconds",["Off","active"],27,3,22,5,50,-400],
[29,0,"Going Big","Large weapons have X% extra damage",[0,1,4,8,14,20],0,0,0,0,100,-100],
[30,29,"Steady Bloodflow","Casting a spell using health regenerates X mana",[0,4,7,12],0,0,0,0,200,-200],
[31,30,"Berserker","Being below 66% Health gives you X extra Damage",[0,5,8,13],0,0,0,0,200,-300],
[32,31,"Overwhelming Force","When using Large weapon, attacking has a 35% chance of casting an area of effect spell around the target",["Off","active"],31,3,29,5,200,-400],
[33,30,"Wrecking It","Casting a Blade or Physical spell will make your next attack deal X extra True Damage",[0,4,8,14],0,0,0,0,300,-300],
[34,33,"Magic Blade","Removes negative effects from Large Weapnsand gain 10% Manaleech",["Off","active"],33,3,29,5,375,-400],
[35,34,"Unfathomable Rage","Converts every 2 damage taken into 1 mana, doubles the cost of all spells",["Off","active"],0,0,0,0,425,-300],
[36,0,"Stabbing Preference","Daggers provide X% Lifeleech",[0,1,3,6,10,15],0,0,0,0,100,-20],
[37,36,"Through Puncture","Physical attacks ignore X% of the target’s armor",[0,8,20,35],0,0,0,0,200,-20],
[38,37,"Jagged Rhythm","Attacking using a dagger has a X% chance of dealing extra (Ability/4) True Damage",[0,15,25,50],0,0,0,0,250,-100],
[39,38,"Luck Foreseen","Converts every 6 Ability into 1% chance of attacking twice",["Off","active"],38,3,36,5,350,-100],
[40,39,"Dark Blade","Doubles all True Damage you deal, you also receive the True Damage dealt",["Off","active"],0,0,0,0,425,-200],
[41,37,"Gaff Hack","Casting a Mystic or Time spell has a X% chance of boosting your Attackspeed by 7 for 4 seconds",[0,20,30,50],0,0,0,0,300,-20],
[42,41,"Double Danger","Using two daggers doubles your item damage",["Off","active"],41,3,36,5,425,-20],
[43,0,"Bow Guidance","Bows have X extra Attackspeed",[0,1,2,3,4,6],0,0,0,0,100,50],
[44,43,"Good Technique","Gain X extra Range",[0,1,2,4],0,0,0,0,200,100],
[45,44,"Artisenal Arsenal","Non-magic arrow get +X Damage and break less often",[0,2,4,7],0,0,0,0,300,100],
[46,45,"Explosive Ammo","Arrows have a 25% chance of exploding, dealing area damage that briefly slows",["Off","active"],45,3,43,5,425,100],
[47,44,"Shineshooter","Reduces the cooldown of Arrow spells by X%",[0,10,20,35],0,0,0,0,300,175],
[48,47,"Bullseye","Increases the damage of Arrow and Blade spells on enemies you currently have targeted",["Off","active"],47,3,43,5,425,175],
[49,48,"Tunnelvision","Gain 10 Attackspeed, but you can no longer move while targeting an enemy.",["Off","active"],0,0,0,0,425,250],
[50,0,"Cozy and Useful","Light Armor has X extra mana",[0,1,3,6,10,15],0,0,0,0,-100,150],
[51,50,"Lightfoot","Converts X Free Capacity into 1 Movespeed capping at 3",[0,35,25,10],0,0,0,0,-170,200],
[52,51,"Dress Wizardly","Gear that weighs less than X oz gives you +1 Magic",[0,10,20,35],0,0,0,0,-270,300],
[53,52,"Clothes of the Damned","Removes negative effects from light armor and gain 5% Magic for each equipped Light Armor.",["Off","active"],52,3,50,5,-370,300],
[54,53,"Darkness Embrace","Death spells are 10 times cheaper. Heal, Light and Holy spells are 10 times more expensive.",["Off","active"],0,0,0,0,-445,400],
[55,51,"Breeze in your hair","Not wearing a helmet gives you +X Movespeed",[0,1,2,3],0,0,0,0,-170,300],
[56,55,"Battleboots","Gives 2 Damage for every extra Movespeed",["Off","active"],55,3,50,5,-270,400],
[57,0,"Block Efficiacy","Shields have X% extra defense",[0,1,4,8,13,20],0,0,0,0,0,150],
[58,57,"Rooted Guard","Blocking an attack regenerates X health",[0,1,2,5],0,0,0,0,0,225],
[59,58,"Hex Parry","Successfully blocking an attack will empower your next Arrow or Blade spell by X%",[0,15,35,50],0,0,0,0,50,325],
[60,59,"Bulwark Leap","Casting a Time or Physical spell will double your magic shield, capping at 200",["Off","active"],59,3,57,5,50,400],
[61,58,"Royal Shield","Reduces the cooldown of Defense spells by X%",[0,10,20,35],0,0,0,0,-50,325],
[62,61,"Deflect","Blocking with a magic shield reflects 15% of the damage taken as true damage",["Off","active"],61,3,57,5,-50,400],
[63,62,"Monster Candy","Taunt lasts 100% longer, Conjure and Defense spells are 50% cheaper. Lose 99 Damage.",["Off","active"],0,0,0,0,-150,400],
[64,0,"Well Protected","Heavy Armor has X extra health",[0,1,3,6,10,15],0,0,0,0,100,150],
[65,64,"Heavy Metal","Heavy Armor that weighs more than 100oz has 1 Ability extra",[0,100,75,35],0,0,0,0,150,250],
[66,65,"Magic Steel","Casting a Time or Heal spell will give you a shield equal to X% of your total Armor, capping at 100",[0,50,100,150],0,0,0,0,200,325],
[67,66,"Blessed Plate","Gain 15 Mana and 1 Magic for every equipped Heavy Armor",["Off","active"],66,3,64,5,275,400],
[68,65,"Carry Your Might","Gain 1 Armor for every 100 Max Capacity, capping at X",[0,2,4,8],0,0,0,0,275,250],
[69,68,"Juggernaut","Removes negative effects from Heavy Armor. Gain 5% Ability for each equipped Heavy Armor.",["Off","active"],68,3,64,5,400,325],
[70,69,"Endowed in Steel","Using both your hands gives you +10% lifesteal, +23 Damage, +13 Ability and +7 Attack Speed",["Off","monk"],0,0,0,0,425,400],
        ];
// --- Stat Table Logic ---
const statList = [
    "Health", "Mana", "Magic", "Damage", "Movespeed", "Ability", "Attack Speed", "HP Regen", "MP Regen", "Range", "Armor", "Defense", "Capacity"
];
let addedPoints = {};
statList.forEach(stat => addedPoints[stat] = 0);
let availablePoints = 0;

const allocatableStats = [
    "Health", "Mana", "Magic", "Ability", "HP Regen", "MP Regen", "Capacity"
];

// Class multipliers for each stat and class
const classMultipliers = {
    Squire:    { Health: 1.00, Mana: 1.00, Magic: 1.00, Damage: 1.00, Movespeed: 1.00, Ability: 1.00, "Attack Speed": 1.00, "HP Regen": 1.00, "MP Regen": 1.00, Range: 1.00, Armor: 1.00, Defense: 1.00, Capacity: 1.00 },
    Knight:    { Health: 2.00, Mana: 0.50, Magic: 0.50, Damage: 1.00, Movespeed: 1.00, Ability: 1.25, "Attack Speed": 1.00, "HP Regen": 1.25, "MP Regen": 0.50, Range: 0.50, Armor: 1.50, Defense: 1.50, Capacity: 1.50 },
    Rogue:     { Health: 1.00, Mana: 1.25, Magic: 1.50, Damage: 1.00, Movespeed: 1.00, Ability: 1.50, "Attack Speed": 1.25, "HP Regen": 1.00, "MP Regen": 1.00, Range: 1.00, Armor: 1.00, Defense: 1.00, Capacity: 1.00 },
    Mage:      { Health: 0.75, Mana: 2.00, Magic: 2.00, Damage: 1.00, Movespeed: 1.00, Ability: 0.75, "Attack Speed": 1.00, "HP Regen": 0.75, "MP Regen": 2.00, Range: 1.00, Armor: 0.75, Defense: 0.75, Capacity: 0.75 }
};
// Point value for each allocatable stat
const pointValues = {
    Health: 5,
    Mana: 5,
    Magic: 1,
    Ability: 1,
    "HP Regen": 0.2,
    "MP Regen": 0.2,
    Capacity: 10
};
// Global stat data structure
const statData = {
    Health:      { base: 150, statBonus: 0, itemBonus: 0, traitBonus: 0, final: 150 },
    Mana:        { base: 15,  statBonus: 0, itemBonus: 0, traitBonus: 0, final: 15 },
    Magic:       { base: 0,   statBonus: 0, itemBonus: 0, traitBonus: 0, final: 0 },
    Damage:      { base: 0,   statBonus: 0, itemBonus: 0, traitBonus: 0, final: 0 },
    Movespeed:   { base: 35,  statBonus: 0, itemBonus: 0, traitBonus: 0, final: 35 },
    Ability:     { base: 0,   statBonus: 0, itemBonus: 0, traitBonus: 0, final: 0 },
    "Attack Speed": { base: 10,  statBonus: 0, itemBonus: 0, traitBonus: 0, final: 10 },
    "HP Regen":     { base: 1,   statBonus: 0, itemBonus: 0, traitBonus: 0, final: 1 },
    "MP Regen":     { base: 1,   statBonus: 0, itemBonus: 0, traitBonus: 0, final: 1 },
    Range:       { base: 15,  statBonus: 0, itemBonus: 0, traitBonus: 0, final: 15 },
    Armor:       { base: 0,   statBonus: 0, itemBonus: 0, traitBonus: 0, final: 0 },
    Defense:     { base: 0,   statBonus: 0, itemBonus: 0, traitBonus: 0, final: 0 },
    Capacity:    { base: 225, statBonus: 0, itemBonus: 0, traitBonus: 0, final: 225 }
};

// Define baseValues for each stat (used in updateStatTable)
const baseValues = {
    Health: 150,
    Mana: 15,
    Magic: 0,
    Damage: 0,
    Movespeed: 35,
    Ability: 0,
    "Attack Speed": 10,
    "HP Regen": 1,
    "MP Regen": 1,
    Range: 15,
    Armor: 0,
    Defense: 0,
    Capacity: 225
};

function updateStatData() {
    // Update statBonus from allocated points
    statData.Health.statBonus = addedPoints["Health"] * 5;
    statData.Mana.statBonus = addedPoints["Mana"] * 5;
    statData.Magic.statBonus = addedPoints["Magic"] * 1;
    statData.Ability.statBonus = addedPoints["Ability"] * 1;
    statData["HP Regen"].statBonus = addedPoints["HP Regen"] * 0.2;
    statData["MP Regen"].statBonus = addedPoints["MP Regen"] * 0.2;
    statData.Capacity.statBonus = addedPoints["Capacity"] * 10;
    // Other stats get 0 from stat allocation
    statData.Damage.statBonus = 0;
    statData.Movespeed.statBonus = 0;
    statData["Attack Speed"].statBonus = 0;
    statData.Range.statBonus = 0;
    statData.Armor.statBonus = 0;
    statData.Defense.statBonus = 0;
    // Item and trait bonuses can be set elsewhere
    // Calculate final values (with class multiplier)
    const currentClass = selectedClass || "Squire";
    for (let stat in statData) {
        const mult = classMultipliers[currentClass][stat] || 1;
        statData[stat].final = (
            statData[stat].base +
            statData[stat].statBonus +
            statData[stat].itemBonus +
            statData[stat].traitBonus
        ) * mult;
    }
}
// Example dependent stat calculation
function getBowDamage() {
    // Example: Bow Damage = Damage.final * 1.5 + Attack Speed.final * 0.5

    let value = statData["Damage"].final / (statData["Attack Speed"].final / 100);
    console.log("Bow Damage:", value);
    return value;
}
function getDPS() {
    // Example: DPS = Damage.final / Attack Speed.final
    return statData["Attack Speed"].final !== 0 ? (statData.Damage.final / statData["Attack Speed"].final) : 0;
}
// In updateStatTable, call updateStatData() before rendering
function updateStatTable() {
    const level = selectedLevel;
    const totalStatPoints = (level - 1) * 3;
    let usedPoints = 0;
    statList.forEach(stat => usedPoints += addedPoints[stat]);
    availablePoints = totalStatPoints - usedPoints;
    // Update stat counter cell
    document.querySelector('.stat-counter').innerHTML =
        `<div style='width:100%;text-align:center;'>Available: <span id='available-points'>${availablePoints}</span><br>Total: <span id='total-points'>${totalStatPoints}</span></div>`;
    // Build stat table (manual rows for each stat)
    let html = `<div class=\"stat-table-outer\">`;
    html += `<div class=\"stat-container\">
        <div>Stat</div>
        <div>Class Multiplier</div>
        <div>Base</div>
        <div>-</div>
        <div>+</div>
        <div>Pts</div>
        <div style='min-width:120px;'>Stat Calculation</div>
        <div>Stat Bonus</div>
        <div style='min-width:120px;'>Item Calculation</div>
        <div>Item Bonus</div>
        <div style='min-width:120px;'>Traits Calculation</div>
        <div>Traits Bonus</div>
    </div>`;
    const currentClass = selectedClass || "Squire";
    // Health
    html += buildStatRow("Health", baseValues["Health"], currentClass);
    // Mana
    html += buildStatRow("Mana", baseValues["Mana"], currentClass);
    // Magic
    html += buildStatRow("Magic", baseValues["Magic"], currentClass);
    // Damage
    html += buildStatRow("Damage", baseValues["Damage"], currentClass);
    // Movespeed
    html += buildStatRow("Movespeed", baseValues["Movespeed"], currentClass);
    // Ability
    html += buildStatRow("Ability", baseValues["Ability"], currentClass);
    // Attack Speed
    html += buildStatRow("Attack Speed", baseValues["Attack Speed"], currentClass);
    // HP Regen
    html += buildStatRow("HP Regen", baseValues["HP Regen"], currentClass);
    // MP Regen
    html += buildStatRow("MP Regen", baseValues["MP Regen"], currentClass);
    // Range
    html += buildStatRow("Range", baseValues["Range"], currentClass);
    // Armor
    html += buildStatRow("Armor", baseValues["Armor"], currentClass);
    // Defense
    html += buildStatRow("Defense", baseValues["Defense"], currentClass);
    // Capacity
    html += buildStatRow("Capacity", baseValues["Capacity"], currentClass);
    html += `</div>`;
    document.getElementById('stats-table-container').innerHTML = html;
}
function buildStatRow(stat, baseValue, currentClass) {
    let added = addedPoints[stat];
    let canAllocate = false;
    let classMult = 1;
    let multiplier = '';
    let pointVal = 0;
    let statCalc = '';
    let statBonus = 0;
    let itemCalc = '';
    let itemBonus = 0;
    canAllocate = allocatableStats.includes(stat);
    classMult = classMultipliers[currentClass][stat] || 1;
    multiplier = (classMult * 100).toFixed(0)+"%";
    pointVal = pointValues[stat] || 0;
    statCalc = `${baseValue}`;
    if (canAllocate && added > 0) statCalc += ` + [(${added} x ${pointVal}) x ${multiplier}]`;
    
    if (canAllocate) statBonus += added * pointVal;
    statBonus = (statBonus * classMult).toFixed(2);
    //get this stat's item bonus from all class item-slot elements
    const itemSlots = document.querySelectorAll('.item-slot');
    itemSlots.forEach(slot => {
        const img = slot.querySelector('img');
        if (img && img.alt) {
            console.log(`Processing item: ${img.alt}`);
            const itemName = img.alt.split(';')[0];
            const itemRarity = img.alt.split(';')[1] || '';
            console.log(`Item name: ${itemName}, Rarity: ${itemRarity}`);
            //find using item's name and rarity [1]
            const item = items.find(i => i[0] === itemName && i[20] === itemRarity);
            if (item) {
                //name	 slot	 type	 weight	 range	 DMG	 hp	 mana	ability	 magic	 arm	 def	 moveS	 atkSpd	 ??	 eqSize	HP reg	MP reg	 description 	rarity

                switch(stat){
                    case "Health":
                        itemBonus += item[6] || 0;
                        if(item[6] != null){
                            if(itemCalc != ''){
                                itemCalc += ` + `;
                            }
                            itemCalc += `${item[6] || 0}`;
                        }
                        break;
                    case "Mana":
                        itemBonus += item[7] || 0;
                        if(item[7] != null){
                            if(itemCalc != ''){
                                itemCalc += ` + `;
                            }
                            itemCalc += `${item[7] || 0}`;
                        }
                        break;
                    case "Magic":
                        itemBonus += item[9] || 0;
                        if(item[9] != null){
                            if(itemCalc != ''){
                                itemCalc += ` + `;
                            }
                            itemCalc += `${item[9] || 0}`;
                        }
                        break;
                    case "Damage":
                        itemBonus += item[5] || 0;
                        if(item[5] != null){
                            if(itemCalc != ''){
                                itemCalc += ` + `;
                            }
                            itemCalc += `${item[5] || 0}`;
                        }
                        break;
                    case "Movespeed":
                        itemBonus += item[12] || 0;
                        if(item[12] != null){
                            if(itemCalc != ''){
                                itemCalc += ` + `;
                            }
                            itemCalc += `${item[12] || 0}`;
                        }
                        break;
                    case "Ability":
                        itemBonus += item[8] || 0;
                        if(item[8] != null){
                            if(itemCalc != ''){
                                itemCalc += ` + `;
                            }
                            itemCalc += `${item[8] || 0}`;
                        }
                        break;
                    case "Attack Speed":
                        itemBonus += item[13] || 0;
                        if(item[13] != null){
                            if(itemCalc != ''){
                                itemCalc += ` + `;
                            }
                            itemCalc += `${item[13] || 0}`;
                        }
                        break;
                    case "HP Regen":
                        itemBonus += item[16] || 0;
                        if(item[16] != null){
                            if(itemCalc != ''){
                                itemCalc += ` + `;
                            }
                            itemCalc += `${item[16] || 0}`;
                        }
                        break;
                    case "MP Regen":
                        itemBonus += item[17] || 0;
                        if(item[17] != null){
                            if(itemCalc != ''){
                                itemCalc += ` + `;
                            }
                            itemCalc += `${item[17] || 0}`;
                        }
                        break;
                    case "Range":
                        itemBonus += item[4] || 0;
                        if(item[4] != null){
                            if(itemCalc != ''){
                                itemCalc += ` + `;
                            }
                            itemCalc += `${item[4] || 0}`;
                        }
                        break;
                    case "Armor":
                        itemBonus += item[10] || 0;
                        if(item[10] != null){
                            if(itemCalc != ''){
                                itemCalc += ` + `;
                            }
                            itemCalc += `${item[10] || 0}`;
                        }
                        break;
                    case "Defense":
                        itemBonus += item[11] || 0;
                        if(item[11] != null){
                            if(itemCalc != ''){
                                itemCalc += ` + `;
                            }
                            itemCalc += `${item[11] || 0}`;
                        }
                        break;
                    case "Capacity":
                        itemBonus += item[15] || 0;
                        if(item[15] != null){
                            if(itemCalc != ''){
                                itemCalc += ` + `;
                            }
                            itemCalc += `${item[15] || 0}`;
                        }
                        break;
                }
                
                console.log(`Found item: ${item[0]} with rarity ${itemRarity}`);
                const itemStat = item[stat.toLowerCase().replace(' ', '')];
                if (itemStat && !isNaN(itemStat)) {
                    itemBonus += itemStat * classMult;
                    itemCalc += ` + ${itemStat}`;
                }
            }
        }
    });

    if (itemCalc != ''){
        itemCalc =  `[(`+itemCalc+`) x ${multiplier}]`;
    }
    return `<div class=\"stat-container\">
        <div>${stat}</div>
        <div>${multiplier}</div>
        <div>${baseValue}</div>
        <div>${canAllocate && added > 0 ? `<button onclick='subtractPoint(\"${stat}\")'>-</button>` : ''}</div>
        <div>${canAllocate && (availablePoints > 0 && added < selectedLevel) ? `<button onclick='addPoint(\"${stat}\")'>+</button>` : ''}</div>
        <div>${added}</div>
        <div>${statCalc}</div>
        <div>${statBonus}</div>
        <div>${itemCalc}</div>
        <div>${itemBonus * classMult}</div>
        <div style='min-width:120px;'>-</div>
        <div style='min-width:120px;'>-</div>
    </div>`;
}
// Hook stat table update to level and class selection
(function() {
    const origUpdateDebug = window.updateDebug;
    window.updateDebug = function() {
        if(origUpdateDebug) origUpdateDebug();
        updateStatTable();
    };
})();
window.addEventListener('DOMContentLoaded', updateStatTable);
function addPoint(stat) {
    const level = selectedLevel;
    if (availablePoints > 0 && addedPoints[stat] < level) {
        addedPoints[stat]++;
        updateStatTable();
    }
}
function subtractPoint(stat) {
    if (addedPoints[stat] > 0) {
        addedPoints[stat]--;
        updateStatTable();
    }
}
// --- TRAIT TREE LOGIC (ported from calc.html, adapted for calc2.html) ---
let selectedTraits = {};
let availableTraitPoints = 0;
function renderTraitTree() {
    const traitTreeUI = document.getElementById('trait-tree-ui');
    traitTreeUI.innerHTML = '';
    // Add trait points counter
    const pointsDiv = document.createElement('div');
    pointsDiv.style.position = 'absolute';
    pointsDiv.style.top = '10px';
    pointsDiv.style.left = '10px';
    pointsDiv.style.fontSize = '1.2em';
    pointsDiv.innerHTML = `Trait Points: <span id="available-trait-points">${availableTraitPoints}</span>`;
    traitTreeUI.appendChild(pointsDiv);
    // Main panel
    const traitsPanel = document.createElement('div');
    traitsPanel.className = 'traits-panel';
    traitsPanel.id = 'traits-panel';
    traitsPanel.style.width = '100%';
    traitsPanel.style.height = '100%';
    traitsPanel.style.position = 'relative';
    // List container
    const traitsList = document.createElement('div');
    traitsList.id = 'traits-list';
    traitsPanel.appendChild(traitsList);
    traitTreeUI.appendChild(traitsPanel);
    // First pass: create trait divs
    traits.forEach(trait => {
        const traitDiv = document.createElement('div');
        traitDiv.setAttribute('data-trait-id', trait[0]);
        traitDiv.classList.add('trait');
        const locationMultiplierX = 1.2;
        const locationMultiplierY = 1.5;
        const centerSpot = [550, 450];
        if (trait[0] === 0) {
            traitDiv.style.position = 'absolute';
            traitDiv.style.left = `${(centerSpot[0] + trait[9])*locationMultiplierX}px`;
            traitDiv.style.top = `${(centerSpot[1] + trait[10])*locationMultiplierY}px`;
            traitDiv.style.width = "130px";
            traitDiv.style.height = "130px";
            traitDiv.classList.add('centerImage');
            traitDiv.innerHTML = `<img class="wizardMan" src="CommunityIcon.png">`;
            traitDiv.style.background = "transparent";
            traitDiv.style.textAlign = "center";
            traitDiv.style.verticalAlign = "middle";
            traitDiv.style.alignContent = "center";
            traitDiv.style.marginTop="-5px";
            traitDiv.style.border = "0px solid black";
            traitsList.appendChild(traitDiv);
        } else {
            const traitTitle = document.createElement('div');
            traitTitle.classList.add('trait-title');
            traitTitle.textContent = trait[2];
            const traitDescription = document.createElement('div');
            traitDescription.classList.add('trait-description');
            traitDescription.textContent = trait[3];
            traitDiv.appendChild(traitTitle);
            selectedTraits[trait[0]] = 0;
            traitDiv.appendChild(traitDescription);
            const traitStages = document.createElement('div');
            traitStages.classList.add('trait-stages');
            trait[4].forEach(stage => {
                const button = document.createElement('button');
                button.textContent = stage;
                button.style.pointerEvents = 'none';
                if (stage == 0 || stage == "0%" || stage === "0" || stage === "Off") {
                    button.classList.add('active', 'first-stage');
                    selectedTraits[trait[0]] = stage;
                }
                traitStages.appendChild(button);
            });
            traitDiv.appendChild(traitStages);
            traitDiv.addEventListener('click', function() {
                increaseTraitStage(trait[0], traitStages);
            });
            traitDiv.addEventListener('contextmenu', function(e) {
                e.preventDefault();
                decreaseTraitStage(trait[0], traitStages);
            });
            traitDiv.style.position = 'absolute';
            traitDiv.style.left = `${(centerSpot[0] + trait[9])*locationMultiplierX}px`;
            traitDiv.style.top = `${(centerSpot[1] + trait[10])*locationMultiplierY}px`;
            traitsList.appendChild(traitDiv);
        }
    });
    // Second pass: draw connectors
    traits.forEach(trait => {
        if (trait[1] > -1) {
            const parentTrait = traits.find(t => t[0] === trait[1]);
            if (parentTrait) {
                const locationMultiplierX = 1.2;
                const locationMultiplierY = 1.5;
                const centerSpot = [550, 450];
                const traitX = (centerSpot[0] + trait[9]) * locationMultiplierX + 50;
                const traitY = (centerSpot[1] + trait[10]) * locationMultiplierY + 30;
                const parentX = (centerSpot[0] + parentTrait[9]) * locationMultiplierX + 50;
                const parentY = (centerSpot[1] + parentTrait[10]) * locationMultiplierY + 30;
                let differenceBetweenX = traitX - parentX;
                let differenceBetweenY = traitY - parentY;
                const line = document.createElementNS("http://www.w3.org/2000/svg", "line");
                let startX = 0;
                let startY = 0;
                if(differenceBetweenX < 0){ startX = Math.abs(differenceBetweenX) * 2; }
                if(differenceBetweenY < 0){ startY = Math.abs(differenceBetweenY) * 2; }
                line.setAttribute("x1", startX);
                line.setAttribute("y1", startY);
                line.setAttribute("x2", Math.abs(differenceBetweenX) + 3);
                line.setAttribute("y2", Math.abs(differenceBetweenY) + 3);
                line.classList.add('connector');
                const svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
                svg.classList.add('connector');
                svg.style.position = 'absolute';
                svg.style.left = traitX-Math.abs(differenceBetweenX)+'px';
                svg.style.top = traitY-Math.abs(differenceBetweenY)+'px';
                svg.style.width = 2*Math.abs(differenceBetweenX)+3+'px';
                svg.style.height = 2*Math.abs(differenceBetweenY)+3+'px';
                svg.appendChild(line);
                traitsPanel.appendChild(svg);
            }
        }
    });
}
function checkTraitRequirements(traitId, targetStage) {
    const trait = traits.find(t => t[0] == traitId);
    if (!trait) return { success: false };
    let requirementsMet = true;
    let failedTrait = null;
    // Check first requirement
    if (trait[5] !== 0) {
        const req1 = traits.find(t => t[0] == trait[5]);
        if (req1) {
            const req1Stage = getStageIndex(req1[0]);
            if (req1Stage < trait[6]) {
                requirementsMet = false;
                failedTrait = req1[0];
            }
        }
    }
    // Check second requirement
    if (requirementsMet && trait[7] !== 0) {
        const req2 = traits.find(t => t[0] == trait[7]);
        if (req2) {
            const req2Stage = getStageIndex(req2[0]);
            if (req2Stage < trait[8]) {
                requirementsMet = false;
                failedTrait = req2[0];
            }
        }
    }
    // Check parent trait stage
    if (requirementsMet && trait[1] !== 0) {
        const parentTrait = traits.find(t => t[0] == trait[1]);
        if (parentTrait) {
            const parentStage = getStageIndex(parentTrait[0]);
            if (parentStage < targetStage) {
                requirementsMet = false;
                failedTrait = parentTrait[0];
            }
        }
    }
    return {
        success: requirementsMet,
        failedTraitId: failedTrait
    };
}
function highlightFailedRequirement(traitId) {
    const traitDiv = document.querySelector(`.trait[data-trait-id="${traitId}"]`);
    if (traitDiv) {
        traitDiv.classList.add('requirement-error');
        setTimeout(() => {
            traitDiv.classList.remove('requirement-error');
        }, 1000);
    }
}
function increaseTraitStage(traitId, stagesElement) {
    if (availableTraitPoints <= 0) return;
    const trait = traits.find(t => t[0] == traitId);
    if (!trait) return;
    const currentStage = getStageIndex(traitId);
    if (currentStage >= trait[4].length - 1) return;
    // REQUIREMENT CHECK
    const requirementCheck = checkTraitRequirements(traitId, currentStage + 1);
    if (!requirementCheck.success) {
        highlightFailedRequirement(requirementCheck.failedTraitId);
        return;
    }
    const newStage = trait[4][currentStage + 1];
    selectedTraits[traitId] = newStage;
    if(stagesElement == ""){
        stagesElement = document.querySelector(`.trait[data-trait-id="${traitId}"] .trait-stages`);
    }
    updateStageButtons(stagesElement, currentStage + 1);
    const traitDiv = document.querySelector(`.trait[data-trait-id="${traitId}"]`);
    if (currentStage + 1 > 0) {
        traitDiv.classList.add('active');
        traitDiv.offsetHeight;
    } else {
        traitDiv.classList.remove('active');
    }
    availableTraitPoints--;
    if(availableTraitPoints <= 0){ availableTraitPoints = 0; }
    document.getElementById('available-trait-points').textContent = availableTraitPoints;
}
function findDependentTraits(traitId, currentStage) {
    let dependentTraits = [];
    traits.forEach(trait => {
        // Check if this trait has the given traitId as a requirement
        if ((trait[5] === traitId && getStageIndex(trait[0]) > 0) ||
            (trait[7] === traitId && getStageIndex(trait[0]) > 0) ||
            (trait[1] === traitId && getStageIndex(trait[0]) > 0)) {
            dependentTraits.push(trait[0]);
        }
    });
    return dependentTraits;
}
function decreaseTraitStage(traitId, stagesElement) {
    const trait = traits.find(t => t[0] == traitId);
    if (!trait) return;
    const currentStage = getStageIndex(traitId);
    if (currentStage <= 0) return;
    // Check if any child traits would become invalid after subtraction
    let blockingTraits = [];
    traits.forEach(child => {
        // Only check traits that have this as a parent or requirement
        if ((child[1] === traitId || child[5] === traitId || child[7] === traitId) && getStageIndex(child[0]) > 0) {
            // Simulate the new stage for this trait
            let simulatedStage = currentStage - 1;
            // Check requirements for the child as if this trait was at simulatedStage
            let reqCheck = checkTraitRequirements(child[0], getStageIndex(child[0]));
            // Temporarily override getStageIndex for this trait
            const origGetStageIndex = window.getStageIndex;
            window.getStageIndex = function(id) {
                if (id == traitId) return simulatedStage;
                return origGetStageIndex(id);
            };
            let wouldFail = !checkTraitRequirements(child[0], getStageIndex(child[0])).success;
            window.getStageIndex = origGetStageIndex;
            if (wouldFail) blockingTraits.push(child[0]);
        }
    });
    if (blockingTraits.length > 0) {
        blockingTraits.forEach(highlightFailedRequirement);
        return;
    }
    const newStage = trait[4][currentStage - 1];
    selectedTraits[traitId] = newStage;
    updateStageButtons(stagesElement, currentStage - 1);
    const traitDiv = document.querySelector(`.trait[data-trait-id="${traitId}"]`);
    if (currentStage - 1 > 0) {
        traitDiv.classList.add('active');
    } else {
        traitDiv.classList.remove('active');
    }
    availableTraitPoints++;
    document.getElementById('available-trait-points').textContent = availableTraitPoints;
}
function getStageIndex(traitId) {
    const trait = traits.find(t => t[0] == traitId);
    if (!trait) return 0;
    const currentValue = selectedTraits[traitId];
    return trait[4].findIndex(stage => stage == currentValue);
}
function updateStageButtons(stagesElement, activeIndex) {
    const buttons = stagesElement.querySelectorAll('button');
    buttons.forEach((button, index) => {
        button.classList.remove('active');
        if (index === activeIndex) {
            button.classList.add('active');
            if (index === 0) {
                button.classList.add('first-stage');
            }
        }
    });
}
// --- Hook up trait tree rendering to toggle ---
window.addEventListener('DOMContentLoaded', function() {
    // Set trait points based on level (example: 1 per 2 levels)
    const levelInput = document.getElementById('level-input');
    function updateTraitPoints() {
        const level = parseInt(levelInput.value) || 1;
        availableTraitPoints = Math.floor(level / 2);
        if(document.getElementById('trait-tree-ui').style.display !== 'none') {
            renderTraitTree();
        }
    }
    levelInput.addEventListener('input', updateTraitPoints);
    // Render trait tree when toggled on
    const traitCounter = document.querySelector('.trait-counter');
    traitCounter.addEventListener('click', function() {
        if(document.getElementById('trait-tree-ui').style.display !== 'none') {
            renderTraitTree();
        }
    });
});
</script>
<script>
// --- Equipment grid interactivity and item picker ---
let selectedEquipSlot = null;
function setupEquipmentGrid() {
    const itemSlots = document.querySelectorAll('.item-slot');
    itemSlots.forEach(slot => {
        slot.onclick = function() {
            selectedEquipSlot = slot;
            itemSlots.forEach(s => s.classList.remove('selected-equip-slot'));
            slot.classList.add('selected-equip-slot');
            console.log("Selected slot:", slot.getAttribute('data-slot'));
            populateItemPicker(slot.getAttribute('data-slot'));
        };
    });
    patchSimpleItemHover();
}
function populateItemPicker(slotType) {
    const picker = document.querySelector('.upper-col3');
    picker.innerHTML = '';
    const grid = document.createElement('div');
    grid.className = 'selection-grid';
    items.forEach(item => {
        if(item[1] === slotType) {
            const selectionItem = document.createElement('div');
            selectionItem.className = 'selection-item';
            const img = document.createElement('img');
            // Use both name and rarity in alt for correct matching
            const rarity = item[item.length-1] || '';
            img.src = `Items/${item[item.length-2]}`;
            img.alt = `${item[0]};${rarity}`;
            selectionItem.appendChild(img);
            selectionItem.onclick = function() {
                if(selectedEquipSlot) {
                    let slotImg = selectedEquipSlot.querySelector('img');
                    if(!slotImg) {
                        slotImg = document.createElement('img');
                        selectedEquipSlot.appendChild(slotImg);
                    }
                    slotImg.src = `Items/${item[item.length-2]}`;
                    slotImg.alt = `${item[0]};${rarity}`;
                    slotImg.style.display = 'block';
                    // Debug log for troubleshooting
                    console.log("Chosen item:", item[0]);
                    updateDebug();
                    // Re-attach equipment grid listeners if needed
                    setupEquipmentGrid();
                }
            };
            grid.appendChild(selectionItem);
        }
    });
    picker.appendChild(grid);
    patchSimpleItemHover();
}
// Patch hover logic for equipment grid and item picker
function patchSimpleItemHover() {
    // Equipment grid
    document.querySelectorAll('.item-slot').forEach(slot => {
        slot.onmouseover = function() {
            const img = slot.querySelector('img');
            if(img && img.alt) {
                const [name, rarity] = img.alt.split(';');
                const item = items.find(i => i[0] === name && (i[i.length-1] === rarity || (!i[i.length-1] && !rarity)));
                if(item) showItemName(item);
            }
        };
        slot.onmouseout = clearItemName;
    });
    // Item picker
    document.querySelectorAll('.selection-item').forEach(sel => {
        sel.onmouseover = function() {
            const img = sel.querySelector('img');
            if(img && img.alt) {
                const [name, rarity] = img.alt.split(';');
                const item = items.find(i => i[0] === name && (i[i.length-1] === rarity || (!i[i.length-1] && !rarity)));
                if(item) showItemName(item);
            }
        };
        sel.onmouseout = clearItemName;
    });
}
// Ensure equipment grid is set up after DOMContentLoaded
window.addEventListener('DOMContentLoaded', function() {
    setupEquipmentGrid();
});
</script>
<script>
function showItemName(item) {
    const descCell = document.querySelector('.upper-col2-row1-desc');
    if (!descCell || !item) return;
    // Build description
    let html = `${item[0]}<br>`;
    if(item[16]) html += `${item[16]}<br>`;
    if(item[2]) html += `Type: ${item[2]}<br>`;
    // List of stat fields to check and display
    const statFields = [
        { label: 'Ability', idx: 8 },
        { label: 'Magic', idx: 9 },
        { label: 'Armor', idx: 10 },
        { label: 'Defense', idx: 11 },
        { label: 'Move Speed', idx: 12 },
        { label: 'Attack Speed', idx: 13 },
        { label: 'HP', idx: 6 },
        { label: 'Mana', idx: 7 },
        { label: 'Damage', idx: 5 },
        { label: 'Range', idx: 4 },
        { label: 'Equip Size', idx: 15 }
    ];
    statFields.forEach(f => {
        const val = item[f.idx];
        if(val && !isNaN(val) && Number(val) !== 0) {
            html += `${f.label}: ${val}<br>`;
        }
    });
    if(item[3] && !isNaN(item[3])) {
        html += `It weighs ${(item[3]/10).toFixed(2)} oz.<br>`;
    }
    // Show rarity if present
    const rarity = item[item.length-1] || '';
    if(rarity) html += `[${rarity}]`;
    descCell.innerHTML = html;
}
function clearItemName() {
    const descCell = document.querySelector('.upper-col2-row1-desc');
    if (descCell) descCell.innerHTML = 'Description';
}
function patchSimpleItemHover() {
    // Equipment grid
    document.querySelectorAll('.item-slot').forEach(slot => {
        slot.onmouseover = function() {
            const img = slot.querySelector('img');
            if(img && img.alt) {
                const [name, rarity] = img.alt.split(';');
                const item = items.find(i => i[0] === name && (i[i.length-1] === rarity || (!i[i.length-1] && !rarity)));
                if(item) showItemName(item);
            }
        };
        slot.onmouseout = clearItemName;
    });
    // Item picker
    document.querySelectorAll('.selection-item').forEach(sel => {
        sel.onmouseover = function() {
            const img = sel.querySelector('img');
            if(img && img.alt) {
                const [name, rarity] = img.alt.split(';');
                const item = items.find(i => i[0] === name && (i[i.length-1] === rarity || (!i[i.length-1] && !rarity)));
                if(item) showItemName(item);
            }
        };
        sel.onmouseout = clearItemName;
    });
}
// Call patchSimpleItemHover after populating equipment grid and item picker
function setupEquipmentGrid() {
    const itemSlots = document.querySelectorAll('.item-slot');
    itemSlots.forEach(slot => {
        slot.onclick = function() {
            selectedEquipSlot = slot;
            itemSlots.forEach(s => s.classList.remove('selected-equip-slot'));
            slot.classList.add('selected-equip-slot');
            console.log("Selected slot:", slot.getAttribute('data-slot'));
            populateItemPicker(slot.getAttribute('data-slot'));
        };
    });
    patchSimpleItemHover();
}
function populateItemPicker(slotType) {
    const picker = document.querySelector('.upper-col3');
    picker.innerHTML = '';
    const grid = document.createElement('div');
    grid.className = 'selection-grid';
    items.forEach(item => {
        if(item[1] === slotType) {
            const selectionItem = document.createElement('div');
            selectionItem.className = 'selection-item';
            const img = document.createElement('img');
            // Use both name and rarity in alt for correct matching
            const rarity = item[item.length-1] || '';
            img.src = `Items/${item[item.length-2]}`;
            img.alt = `${item[0]};${rarity}`;
            selectionItem.appendChild(img);
            selectionItem.onclick = function() {
                if(selectedEquipSlot) {
                    let slotImg = selectedEquipSlot.querySelector('img');
                    if(!slotImg) {
                        slotImg = document.createElement('img');
                        selectedEquipSlot.appendChild(slotImg);
                    }
                    slotImg.src = `Items/${item[item.length-2]}`;
                    slotImg.alt = `${item[0]};${rarity}`;
                    slotImg.style.display = 'block';
                    // Debug log for troubleshooting
                    console.log("Chosen item:", item[0]);
                    updateDebug();
                    // Re-attach equipment grid listeners if needed
                    setupEquipmentGrid();
                }
                       };
            grid.appendChild(selectionItem);
        }
    });
    picker.appendChild(grid);
    patchSimpleItemHover();
}
</script>
<script>
// Add toggle logic for trait tree view
let traitTreeToggled = false;
function toggleTraitTreeView() {
    const plannerUI = document.getElementById('planner-ui');
    const traitTreeUI = document.getElementById('trait-tree-ui');
    if (!traitTreeToggled) {
        plannerUI.style.display = 'none';
        traitTreeUI.style.display = 'flex';
        traitTreeToggled = true;
        renderTraitTree(); // Build the trait tree when shown
    } else {
        plannerUI.style.display = 'flex';
        traitTreeUI.style.display = 'none';
        traitTreeToggled = false;
    }
}
// Attach click event to Trait Counter
window.addEventListener('DOMContentLoaded', function() {
    const traitCounter = document.querySelector('.trait-counter');
    if (traitCounter) {
        traitCounter.style.cursor = 'pointer';
        traitCounter.title = 'Click to toggle trait tree view';
        traitCounter.addEventListener('click', toggleTraitTreeView);
    }
});
</script>
</body>
</html>
